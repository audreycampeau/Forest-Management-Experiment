---
title: "Forest manipulation experiment reveals divergent controls on the sources and age of lateral DOC and CO‚ÇÇ export"
author:
  - name: Audrey Campeau
    affiliation: Universit√© de Montr√©al & SLU
    orcid: 0000-0002-9113-8915
  - name: A. Zannella and M. Wallin
    #affiliation: Their Institution
    #orcid: 0000-0000-0000-0000
date: "`r Sys.Date()`"
format:
  html:
    theme: cosmo
    keep-tex: true
    code-fold: true
    code-summary: "üëà see code here"
    toc: true
    toc-depth: 2
    number-sections: true
    number-depth: 5
    fig-width: 8
    fig-height: 6
    fig-cap-location: margin
  
  pdf:
    documentclass: article
    toc: true
    toc-depth: 2
    number-sections: true
    fig-width: 6
    fig-height: 4
    fig-cap-location: bottom
    keep-tex: true
    echo: false        # Hide code in PDF only
    warning: false
    message: false
    
bibliography: references.bib
crossref:
  fig-title: "Figure"
  tbl-title: "Table"
  fig-prefix: "Figure"
  tbl-prefix: "Table"
---

# Introduction

## General Context

-   Lateral C export is a significant fraction of watershed C balance.

-   Forested catchments contain a large OM storage that could sustain DOC export for decades [@ledesma2013]

-   LCE and NEE are connected over long timescale, by hydrology [@√∂quist2014]

-   Isotopic values of C (stable and radiogenic) can inform us on the sources and age of C.

## Research Question

-   What are the controls over the sources and age of lateral CO2 and DOC export in forested catchments?

-   Can a forest manipulation experiment (forest clearcut and ditch cleaning) provide new insight to test ongoing hypothesis on the controls of LCE in forested catchments?

## Hypothesis

-   The CO2 source and age is more closely linked to the forest C sink [@campeau2019], so clearcutting the forest should have an impact on C sources and age

-   The DOC source and age is linked to discharge [@campeau2017] or water table position [@campeau2019], so changes in watershed hydrology, caused by clear-cutting and draining, should change the source and age of DOC.

## Main Conclusion

DOC is controled more by *hydrological processes*, which determines what material is being mobilised, while CO2 is controled more by *biological processes,* which fuels CO2 in the watershed. Both are therefore controled by different processes, but will likely respond to changes in climate, albeit via different drivers.

# Methodology

## Study Site and Treatment:

-   Six headwater catchments are included in this study:

    -   2 pristine sites (C1 and C2)

    -   4 treated watersheds (DC1 to DC4).

-   The DC sites received different treatments:

    -   Forest in all four sites was clearcut - around July 2020.

    -   Two sites, DC1 and DC3, were also ditch cleaned - in September 2021.

    -   The treatments are named as follow (pristine, clear-cut and ditch cleaning)

## Field measurements:

-   All four sites are monitored for flow and water chemistry on a near continuous basis.

-   Radiocarbon and stable C isotope measurements were collected at those six sites simultaniously and throughout various treatment stages.

-   14C measurements

    -   Start 2020-03-12

    -   End 2022-10-25

## Statistical analysis

-   Dunn's test for non-parametric grouping

-   Linear regression models, combined with ANCOVA to identify significant differences in intercept or slope.

-   Linear mixed-effect models would be possible if we wanted to build a predictive model, but this is not the aim here.

```{r, warning=FALSE, message=FALSE, echo=F}
# Import libraries
library(tidyverse) 
library(plotly) 
library(readxl) 
library(DT) # for interactive datatables
library(leaflet) #for interactive maps
library(htmltools)
library(rstatix) #anova test
library(ggpubr)# show reg.line equation 

#Open dataset
DC_Q <- readRDS(file= "Output/Data/DC_C_Q_Meteo_chem_14C.rds")
DC_Q$Date <- as.Date(DC_Q$Date)
# Remove one oulier 14C-CO2 140%modern at C2 once. 
DC_Q$CO2_14C_Modern= ifelse(DC_Q$CO2_14C_Modern >130, NA, DC_Q$CO2_14C_Modern)

# Order factors site pairs 
DC_Q$Site_id <- factor(DC_Q$Site_id, 
                       levels = c("C2", "C1", "DC2", "DC4", "DC1", "DC3"))


#Code lines to exclude C2 and C1 (pristine control sites) from analysis 
DC_Q = filter(DC_Q, Site_id %in% c(#"C2", "C1", 
                                   "DC2", "DC4", "DC1", "DC3"))

# Define Color Ramp and theme
treatments_colors <- c(
  "Pristine" = "deepskyblue",     # light blue
  "Clearcut" = "#CC6677",     # light red
  "Ditch cleaning" = "#882255" # dark red
)


site_colors_6 <- c(
  # Pristine sites (C2 and C1)
#  "C2" = "#228B22",  # Forest green
#  "C1" = "#90EE90",  # Light green
  
  # Clearcut pair - warm earth tones (your current DC1/DC2)
  "DC2" = "#E69B00", # Light orange
  "DC4" = "#994F00", #Dark brown
  
  # Clearcut+DitchCleaning pair - disturbed/muddy tones
  "DC1" = "#2E5894", #Dark blue
  "DC3" = "#7EA6E0" #Light blue
)



theme_set(theme_bw(base_size = 16))

#Present the dataset with interactivitiy
#datatable(filter(DC_Q, !is.na(DOC_14C_Modern)), options = list(pageLength = 5), filter="top") %>%  
#  formatStyle(columns = colnames(.$x$data), `font-size` = '10px')
```

# Results

## Hydrograph, C concentrations and ¬π‚Å¥C-content across sites over time

```{r, warning=F, message=F, fig.height=4, label: fig-timeseries, fig.cap="Precipitation and discharge timeseries"}


# Define operation periods for treatments::::::::::::::::::::::::::::::::::::::::::
  
clearcut_start <- as.Date("2020-07-01")
clearcut_end <- as.Date("2020-08-25")
ditch_cleaning_start <- as.Date("2021-09-01")
ditch_cleaning_end <- as.Date("2021-09-30")

 
# Make the precipitation graph :::::::::::::::::::::::::::::::::::::::::::::::::::::


precipitation= ggplot(DC_Q %>%
         filter(Site_id %in% c("DC1")),
       aes(y = P, x = as.Date(Date), color = Site_id)) +
  
  # Add gray background bars for operations
  annotate("rect", 
           xmin = clearcut_start, xmax = clearcut_end,
           ymin = -Inf, ymax = Inf, fill = "gray70", alpha = 0.3) +
  
  annotate("rect", 
           xmin = ditch_cleaning_start, xmax = ditch_cleaning_end,
           ymin = -Inf, ymax = Inf, fill = "gray70", alpha = 0.3) +
  
  geom_bar(stat = 'identity', width=0.2) +
  labs( y= "Precipitation (mm/day)") +
  scale_y_reverse()+
  scale_color_manual(values=site_colors_6)+ #"
  scale_x_date(limits=c(as.Date("2020-01-01"), as.Date("2022-11-01")),
               date_labels = "%b-%Y", date_breaks = "6 months") +
  
  
  labs(y = "P (mm/d)",  x = "Date") +
  theme(legend.position = "none", axis.title.x = element_blank())



# Make Hydrograph :::::::::::::::::::::::::::::::::::::::::::::::::::::

hydrograph= ggplot(DC_Q %>%
         filter(Site_id %in% c("DC2", "DC3")),
       aes(y = q_md*1000, x = as.Date(Date), color = Site_id)) +
  
  # Add gray background bars for operations
  annotate("rect", 
           xmin = clearcut_start, xmax = clearcut_end,
           ymin = -Inf, ymax = Inf,
           fill = "gray70", alpha = 0.3) +
  
  annotate("rect", 
           xmin = ditch_cleaning_start, xmax = ditch_cleaning_end,
           ymin = -Inf, ymax = Inf,
           fill = "gray70", alpha = 0.3) +
  
  # Add the discharge lines
  geom_line() +
  scale_color_manual(values=site_colors_6)+ #"
   
  # Add text labels for operations
 annotate("text", x = clearcut_start + (clearcut_end - clearcut_start)/2, y = Inf, 
           label = "Forest clear cut operations\n(July 2020)",
           vjust = 1.2, hjust = 0.5, size = 3.5, color = "black") +
  
  annotate("text", x = ditch_cleaning_start + (ditch_cleaning_end -    ditch_cleaning_start)/2, y = Inf, 
           label = "Ditch cleaning operations\n(September 2021)",
           vjust = 1.2, hjust = 0.5, size = 3.5, color = "black") +
  
  scale_x_date(limits=c(as.Date("2020-01-01"), as.Date("2022-11-01")),
                 date_labels = "%b-%Y", date_breaks = "6 months") +
  labs(y = "q (mm/d)",   x = "Date",  color = "Stream") +
  theme(legend.position = "none", axis.title.x = element_blank())



ggarrange(precipitation, hydrograph,
          ncol=1, align="v")

```

```{r, warning=F, message=F,fig.height=10, fig.cap="C concentration and radiocarbon content timeseries coloured by sites"}

# Timeseries 14C per site, CO2 and DOC seperately
plot_timeseries = function(data, y_var,labs_y) {
  ggplot(data, aes(x=Date, y=!!sym(y_var), group=Site_id, color=Site_id)) +
    geom_line(data=data[!is.na(data[[y_var]]), ]) +
    geom_point(size=3) +
  
  # Add gray background bars for operations
  annotate("rect", 
           xmin = clearcut_start, xmax = clearcut_end,
           ymin = -Inf, ymax = Inf,
           fill = "gray70", alpha = 0.3) +
  
  annotate("rect", 
           xmin = ditch_cleaning_start, xmax = ditch_cleaning_end,
           ymin = -Inf, ymax = Inf,
           fill = "gray70", alpha = 0.3) +
    
    scale_x_date(limits=c(as.Date("2020-01-01"), as.Date("2022-11-01")),
                 date_labels = "%b-%Y", date_breaks = "6 months") +
    scale_color_manual(values=c(site_colors_6))+
    labs(y=labs_y)+
    
    theme( # set margins to align combined plots 
      plot.margin = margin(5.5, 5.5, 5.5, 5.5, "pt"),
      axis.text.x = element_text(size = 10),
      axis.title.x = element_text(size = 11),
      panel.grid.major = element_line(size = 0.5),
      panel.grid.minor = element_line(size = 0.25)
    )

}



#Concentration timeseries


timeserie_DOC = ggExtra::ggMarginal(
  plot_timeseries(DC_Q, "DOC_mgL", "DOC (mg/L)")+
    # Add text labels for operations
 annotate("text", x = clearcut_start + (clearcut_end - clearcut_start)/2, y = Inf, 
           label = "Forest clear cut operations\n(July 2020)",
           vjust = 1.2, hjust = 0.5, size = 3.5, color = "black") +
  
  annotate("text", x = ditch_cleaning_start + (ditch_cleaning_end -    ditch_cleaning_start)/2, y = Inf, 
           label = "Ditch cleaning operations\n(September 2021)",
           vjust = 1.2, hjust = 0.5, size = 3.5, color = "black") +
  theme(legend.position = "top", axis.title.x = element_blank()),
  margins=c("y"), type = "boxplot", groupColour = TRUE, groupFill = TRUE )


timeserie_14CDOC = ggExtra::ggMarginal(
  plot_timeseries(DC_Q, "DOC_14C_Modern", "14C-DOC (%)")+
  scale_y_continuous(limits=c(95,115))+
  theme(legend.position = "none", axis.title.x = element_blank()),
  margins=c("y"), type = "boxplot", groupColour = TRUE, groupFill = TRUE )



timeserie_CO2 = ggExtra::ggMarginal(
  plot_timeseries(DC_Q, "CO2_mgL", "CO2 (mg/L)")+
     theme(legend.position = "none", axis.title.x = element_blank()),
  margins=c("y"), type = "boxplot", groupColour = TRUE, groupFill = TRUE )

timeserie_14CCO2 = ggExtra::ggMarginal(
  plot_timeseries(DC_Q, "CO2_14C_Modern", "14C-CO2 (%)")+
  scale_y_continuous(limits=c(95,115))+
   theme(legend.position = "none", axis.title.x = element_blank()),
  margins=c("y"), type = "boxplot", groupColour = TRUE, groupFill = TRUE )


# Combine four plts
library(gridExtra)



final_plot <- grid.arrange(
  timeserie_DOC,
  timeserie_14CDOC,
  timeserie_CO2,
  timeserie_14CCO2,
  ncol = 1,
  heights = c( 0.75, 0.5, 0.5, 0.55)
)


```

#### Dunn's test \| ¬π‚Å¥C and \[C\] \~ Site

```{r}
# Calculate medians for each variable by Site_id
combined_medians <- DC_Q %>%
  group_by(Site_id) %>%
  summarise(
    "[DOC]" = round(median(DOC_mgL, na.rm = TRUE), 2),
    "14C-DOC" = round(median(DOC_14C_Modern, na.rm = TRUE),2),
    "[CO2]" = round(median(CO2_mgL, na.rm = TRUE), 2),
    "14C-CO2" = round(median(CO2_14C_Modern, na.rm = TRUE),2),
    .groups = 'drop'
  ) %>%
  rename(Site = Site_id)

knitr::kable(combined_medians, 
             caption = "Median by site for DOC and CO2 concentration and 14C-content")

```

```{r,warning =F, message=F}

library(dunn.test)
library(multcompView)
library(PMCMR)
# Perform the test and get multcomp letters
DOCSites_letters = multcompLetters(get.pvalues(PMCMRplus::kwAllPairsDunnTest(
          DC_Q$DOC_mgL ~ DC_Q$Site_id, p.adjust="bonf")),
          threshold=0.05)$Letters

DOC_14C_Sites_letters = multcompLetters(get.pvalues(PMCMRplus::kwAllPairsDunnTest(
          DC_Q$DOC_14C_Modern ~ DC_Q$Site_id, p.adjust="bonf")),
          threshold=0.05)$Letters
        
CO2Sites_letters = multcompLetters(get.pvalues(PMCMRplus::kwAllPairsDunnTest(
          DC_Q$CO2_mgL ~ DC_Q$Site_id, p.adjust="bonf")),
          threshold=0.05)$Letters

CO2_C14_Sites_letters = multcompLetters(get.pvalues(PMCMRplus::kwAllPairsDunnTest(
          DC_Q$CO2_14C_Modern ~ DC_Q$Site_id, p.adjust="bonf")),
          threshold=0.05)$Letters

        
# Combine into a data frame
combined_dunns_results <- data.frame(
  Site = names(DOCSites_letters),
  "[DOC]" = as.character(DOCSites_letters),
  "14C-DOC" = as.character(DOC_14C_Sites_letters),
  "[CO2]" = as.character(CO2Sites_letters[names(DOCSites_letters)]),
  "14C-CO2" = as.character(CO2_C14_Sites_letters[names(DOCSites_letters)]),
  check.names = FALSE
)

knitr::kable(combined_dunns_results, 
             caption = "Grouping letters for dunn's test result")
```

::: callout-note
#### Interpretation

**Trend:**

-   No obvious trends in C concentration or 14C content over time

-   There was a clear peak in DOC and CO2 concentration at DC4 during clearcut opperations.

**Differences between sites:**

-   CO2 and DOC concentration at DC4 is consistently higher than the other sites, followed with DC2, and DC1 and DC3.

-   14C-DOC is not different across sites

-   14C-CO2 is significantly lower at DC4, followed with DC3 and DC2, DC1 which is significantly higher
:::

::: callout-warning
#### Q data

The database contains DC3 and DC2 flow data, one ditch cleaned while the other only clearcut. Other timeseries are incomplete.
:::

## Changes in C concentration or ¬π‚Å¥C-content across Treatments

Is there a significant change in the median ^14^C content of CO~2~ and DOC between sites or treatment, based on their distribution ?

```{r, warning =F, message=F,fig.height=8, fig.cap="relationship between C concentration and radiocarbon content of CO2 and DOC coloured by treatment"}

# Make a scatterplot to distinguish the grouping across sites
density_14Cscatter_sites = 
  ggExtra::ggMarginal(
  
            ggplot(data=DC_Q,
                 aes(x=DOC_mgL, y=CO2_mgL_filled, 
                    color=Treatment))+
            stat_density_2d(aes(fill = Treatment), geom = "polygon", linewidth=0,
                             alpha = 0.2)+ 
            geom_point(size=1)+
            geom_smooth(method="glm", se=F, aes(color=Treatment), show.legend = T)+
  
            stat_regline_equation(label.y.npc = "top", label.x.npc = "left",
            aes(label =  paste(..eq.label.., ..adj.rr.label.., 
                               sep = "~~~~"), color = Treatment), 
                                show.legend = F, size=3)+
    
            scale_color_manual(values=c(treatments_colors))+
            scale_fill_manual(values=c(treatments_colors))+
            scale_y_log10()+
              scale_x_log10()+
            
            labs(x=bquote("DOC (mg L"^-1*")"), 
                   y=bquote("CO"[2]* " (mg L"^-1*")"))+
              theme(legend.position = "none"), 
            type = "boxplot", groupColour = TRUE, groupFill = TRUE ) 



# Make a scatterplot to distinguish the grouping across treatment
density_14Cscatter_treatment = 
ggExtra::ggMarginal(
  
            ggplot(data=DC_Q,aes(x=DOC_14C_Modern, y=CO2_14C_Modern, 
                    color=Treatment))+
               stat_density_2d(aes(fill = Treatment), geom = "polygon", linewidth=0,
                             alpha = 0.2)+ 
            geom_point(size=2)+
            geom_abline(intercept=0,slope=1, linetype="dotted")+
            scale_color_manual(values=c(treatments_colors))+
            scale_fill_manual(values=c(treatments_colors))+
            scale_y_continuous(limit=c(95,115))+
            labs(x=bquote(Delta^14*"C-DOC (% modern)"), 
                   y=bquote(Delta^14*"C-CO"[2]*" (% modern)"))+
              theme(legend.position = "bottom"), 
            type = "boxplot", groupColour = TRUE, groupFill = TRUE )
            


ggarrange(density_14Cscatter_sites,
density_14Cscatter_treatment, nrow=2, align="hv")

```

#### ANCOVA \| \[CO2\] \~ \[DOC\] / Treatment

```{r,warning=F }
#Run ANCOVA test - Difference in hydro. response between treatments


knitr::kable(DC_Q  %>%  anova_test(DOC_mgL ~ CO2_mgL_filled*Treatment), 
             caption = "Ancova test results: DOC ~ CO2 x Treatment")
```

#### Dunn's test \| ¬π‚Å¥C et \[C\]\~ Treatment

```{r}
# Calculate medians for each variable by Site_id
combined_medians <- DC_Q %>%
  group_by(Treatment) %>%
  summarise(
    "14C-DOC" = round(median(DOC_14C_Modern, na.rm = TRUE),2),
     "[DOC]" = round(median(DOC_mgL, na.rm = TRUE), 2),
    "14C-CO2" = round(median(CO2_14C_Modern, na.rm = TRUE),2),
    "[CO2]" = round(median(CO2_mgL, na.rm = TRUE), 2),
    .groups = 'drop'
  ) %>%
  rename(Site = Treatment)

knitr::kable(combined_medians, 
             caption = "Median by treatment for DOC and CO2 concentration and 14C-content")

```

```{r,warning =F, message=F}
library(dunn.test)
library(multcompView)
library(PMCMR)

# Perform the test and get multcomp letters
DOCTreatment_letters = multcompLetters(get.pvalues(PMCMRplus::kwAllPairsDunnTest(
          DC_Q$DOC_mgL ~ DC_Q$Treatment, p.adjust="bonf")),
          threshold=0.05)$Letters
        
DOC_C14_Treatment_letters = multcompLetters(get.pvalues(PMCMRplus::kwAllPairsDunnTest(
          DC_Q$DOC_14C_Modern ~ DC_Q$Treatment, p.adjust="bonf")),
          threshold=0.05)$Letters
        
CO2Treatment_letters = multcompLetters(get.pvalues(PMCMRplus::kwAllPairsDunnTest(
          DC_Q$CO2_mgL ~ DC_Q$Treatment, p.adjust="bonf")),
          threshold=0.05)$Letters

CO2_C14_Treatment_letters = multcompLetters(get.pvalues(PMCMRplus::kwAllPairsDunnTest(
          DC_Q$CO2_14C_Modern ~ DC_Q$Treatment, p.adjust="bonf")),
          threshold=0.05)$Letters

        
# Combine into a data frame
combined_dunns_results <- data.frame(
  Site = names(DOC_C14_Treatment_letters),
  "14C-DOC" = as.character(DOC_C14_Treatment_letters),
  "[DOC]" = as.character(DOCTreatment_letters),
  "14C-CO2" = as.character(CO2_C14_Treatment_letters[names(DOC_C14_Treatment_letters)]),
  "[CO2]" = as.character(CO2Treatment_letters[names(DOC_C14_Treatment_letters)]),
  check.names = FALSE
)


knitr::kable(combined_dunns_results, 
             caption = "Grouping letters for dunns test C concentration and 14C content by treatment")

```

::: callout-note
#### Interpretation

**Relationship between CO2 and DOC concentration:**

-   The relationship between CO2 and DOC concentration is positive for pristine condition, but the slope becomes less significant with clearcut (closer to 0) and not significant (slope =0) with ditch cleaning. Hence the DOC concentration continues to vary across a wide range with treatments, but the CO2 becomes more stable and independant of DOC concentration. This could be due to changes in their mobilization pathways or simply because clearcuting "removes" a CO2 source.

**Treatment** **effect on C concentrations:**

-   The DOC concentrations are significantly higher following clearcut treatment compared with ditchcleaned and pristine conditions (short term effect of ditch cleaning can compensate?)

-   The CO2 concentration do not differ significantly across treatment

**Treatment** **effect on 14 content**

-   The ^14^C-DOC is significantly lower in the pristine (group a) compared with clearcut and ditch cleaning sites.

-   The ^14^C-CO~2~ doesn't differ significantly across treatments
:::

## Relationships - controls on C sources, age and concentrations

### Hydrological control over C concentrations

Is the radiocarbon age or concentration of DOC and CO~2~ controled by runoff, and does this relationship changes following treatment?

```{r, warning=F, message=F, fig.height=8, fig.cap="relationship between C concetration and discharge coloured by site and treatment"}

# Hydrological control over  C concentration by Site
hydro_resp_C_site=
  ggplot(DC_Q %>% pivot_longer(
                     cols = c(DOC_mgL, CO2_mgL),
                     names_to = "Carbon_species",
                     values_to = "C_mgL"
                   ),
       aes(y=C_mgL, x=q_md_filled*1000, color=Site_id))+ 
  geom_point(size=1, show.legend = F)+
    geom_abline(slope = 0.2, intercept = 0.3)+
  facet_wrap(~Carbon_species)+
  scale_x_log10()+
  scale_y_log10()+
  geom_smooth(method="lm", se=F, aes(color=Site_id), show.legend = T)+
  scale_color_manual(values=site_colors_6)+
  stat_regline_equation(label.y.npc = "top", label.x.npc = "left",
  aes(label =  paste(..eq.label.., ..adj.rr.label.., 
                     sep = "~~~~"), color = Site_id), 
                      show.legend = F, size=3)+
  labs(x="q (mm/d)", 
       y=bquote("C (mg/L)"))+
  theme(legend.position = "top", base_size=8)


# Hydrological control over C concentration by treatment
hydro_resp_C_treatment=
  ggplot(DC_Q %>% pivot_longer(
                     cols = c(DOC_mgL, CO2_mgL),
                     names_to = "Carbon_species",
                     values_to = "C_mgL"
                   ),
       aes(y=C_mgL, x=q_md_filled*1000, color=Treatment))+ 
  geom_point(size=1, show.legend = F)+
  facet_wrap(~Carbon_species)+
  scale_x_log10()+
  scale_y_log10()+
  geom_smooth(method="lm", se=F, aes(color=Treatment), show.legend = T)+
  scale_color_manual(values=treatments_colors)+
  stat_regline_equation(label.y.npc = "top", label.x.npc = "left",
  aes(label =  paste(..eq.label.., ..adj.rr.label.., 
                     sep = "~~~~"), color = Treatment), 
                      show.legend = F, size=3)+
  labs(x="q (mm/d)", 
       y=bquote("C (mg/L)"))+
  theme(legend.position = "top", base_size=8)





ggarrange(hydro_resp_C_site, 
          hydro_resp_C_treatment, 
          nrow=2, common.legend = F)

```

#### ANCOVA test

Is there a significant difference in the hydrological response of **DOC** concentrations between *Treatments or Sites*?

```{r, warning=F}
#Run ANCOVA test - Difference in hydro. response between treatments

knitr::kable(DC_Q  %>%  anova_test(DOC_mgL ~ q_md_filled*Treatment), 
             caption = "ANCOVA test results - DOC * q / treatment")

knitr::kable(DC_Q  %>%  anova_test(DOC_mgL ~ q_md_filled*Site_id), 
             caption = "ANCOVA test results - DOC * q / Site")
```

Is there a significant difference in the hydrological response of **CO2** concentrations between *Treatments or Sites*?

```{r, warning=F}
#Run ANCOVA test - Difference in hydro. response between treatments
knitr::kable(DC_Q  %>%  anova_test(CO2_mgL ~ q_md_filled*Site_id), 
             caption = "ANCOVA test results - CO2 * q / treatment")

knitr::kable(DC_Q  %>%  anova_test(CO2_mgL ~ q_md_filled*Site_id), 
             caption = "ANCOVA test results - CO2 * q / treatment")

```

::: callout-note
#### Interpretation

**Hydrological response:**

-   DOC and CO2 concentrations are not controled by discharge, except for DC4 where we believe there is a wetland source that could sustain flow in lowflow conditions.

-   ANCOVA indicates that Q **doesn't** have a significant effect on DOC concentration, but treatment and site do (intercept difference). Significant interaction between Q and Site (slope difference)

-   ANCOVA indicates that Q doesnt have a significant effect on CO2 concentration, nor does treatment. Site effect causes a signficant effect on intercept and slope (interaction)
:::

### Hydrological controls over ^14^C-content

```{r, warning=FALSE, message=FALSE, fig.cap="relationship between radiocarbon content of CO2 and DOC and discharge, coloured by treatment"}
#Scatter coloured by Treatment
ggplot( DC_Q %>% pivot_longer(
                     cols = c(CO2_14C_Modern, DOC_14C_Modern),
                     names_to = "Carbon_specie",
                     values_to = "C14_value"
                   ),
       aes(y=C14_value, x=q_md_filled*1000, fill=Treatment, color=Treatment))+
  geom_point(size=3)+
  geom_smooth(method="glm", se=F, aes(color=Treatment), show.legend = F)+
  scale_fill_manual(values=treatments_colors)+ 
  scale_color_manual(values=treatments_colors)+ 

  stat_regline_equation(
  label.y.npc = "top", label.x.npc = "left",
  aes(label =  paste(..eq.label.., ..adj.rr.label.., 
                     sep = "~~~~"), color = Treatment), 
  show.legend = F, size=4)+
  labs(x="q (m/d)", y=bquote(Delta^14*"C (% modern)"), shape="Watershed ID")+
  facet_wrap(~Carbon_specie, scale="fixed", nrow=1)+
  theme(legend.position = "top")




```

#### ANCOVA test

Is there a significant difference in the hydrological response of **14C-DOC** between *Treatments*?

```{r, warning=F, echo=FALSE}
#Run ANCOVA test - Difference in hydro. response between treatments
knitr::kable(DC_Q  %>%  anova_test(DOC_14C_Modern ~ q_md_filled*Treatment), 
             caption = "Ancova test results: 14C-DOC ~ q x Treatment")
```

Is there a significant difference in the hydrological response of **14C-DOC** between *Sites*?

```{r, warning=F, echo=FALSE}
#Run ANCOVA test - Difference in hydro. response between Sites
knitr::kable(DC_Q %>% anova_test(DOC_14C_Modern ~ q_md_filled*Site_id),
             caption="ANCOVA test results, 14C-DOC * q / Site")


```

Is there a significant difference in the hydrological response of **14C-CO2** between *Treatments*?

```{r, warning=F, echo=FALSE}
#Run ANCOVA test - Difference in hydro. response between treatments
knitr::kable(DC_Q  %>%  anova_test(CO2_14C_Modern ~ q_md_filled*Treatment), 
             caption = "Ancova test results: 14C-CO2 ~ q x Treatment")
```

::: callout-note
#### Interpretation

-   While q doesn't have a significant effect on DOC concentration, it does have a signficant effect on 14C-DOC. The 14C-content generally increases with Q, mobilizing more post-bomb C stored in soils.

-   Treatment has a significant effect in the ANCOVA, indicating that the intercept shift in the 14C-DOC\~q relationship, from 100%modern in pristine sites to 110%modern in clearcut+ditchcleaned sites, is significant. The effect of Site is not significant.

-   Q doesnt have en effect but not on 14C-CO2
:::

## Biological controls over ^14^C-CO~2~ - Keeling plots

```{r, warning=F, message=F, fig.height=6, fig.cap="Keeling plot of CO2 isotope ratio, stable and radiogenic, coloured by treatment"}

DC_Q$CO2_mgL_filled_keeling= 1/DC_Q$CO2_mgL_filled
DC_Q$CO2_mgL_filled_keeling = ifelse(is.infinite (DC_Q$CO2_mgL_filled_keeling), NA, DC_Q$CO2_mgL_filled_keeling)


ggplot(
  DC_Q %>% pivot_longer(
                     cols = c(CO2_14C_Modern, d13C_CO2),
                     names_to = "Carbon_isotope",
                     values_to = "isotope_value"
                   ),
       aes(y=isotope_value, x=CO2_mgL_filled_keeling, 
           color=Treatment))+
  
    geom_smooth(method="glm", se=F, 
                show.legend = F)+ 
    facet_wrap(~Carbon_isotope, scale="free", nrow=2)+
    stat_regline_equation(
    label.y.npc = "top", label.x.npc = "left", #0.5
    aes(label =  paste(..eq.label.., ..adj.rr.label.., sep = "~~~~")), show.legend = F, size=4)+
    
  geom_point() +
  scale_color_manual(values = treatments_colors) +
  scale_fill_manual(values = treatments_colors) +
  labs(x= "1/CO2", y="isotopic ratio")+
  theme(legend.position = "right") 


```

#### ANCOVA test

Does the keeling relationship for **d13C-CO2** varies significantly between treatment?

```{r, warning = F, message = F}

#Run ANCOVA test - Difference in hydro. response between Sites
knitr::kable(DC_Q %>% anova_test(d13C_CO2 ~ CO2_mgL_filled_keeling*Treatment),
             caption="ANCOVA test results, 13C-CO2 Keeling | Treatment") 
#DC_Q %>% anova_test(d13C_CO2 ~ CO2_mgL_filled_keeling*Site_id)

```

Does the keeling relationship for **14C-CO2** varies significantly between treatment?

```{r, warning = F, message = F}
#Run ANCOVA test - Difference in hydro. response between Sites
knitr::kable(DC_Q %>% anova_test(CO2_14C_Modern ~ CO2_mgL_filled_keeling*Treatment),
             caption="ANCOVA test results, 14C-CO2 Keeling | Treatment") 
#DC_Q %>% anova_test(CO2_14C_Modern ~ CO2_mgL_filled_keeling*Site_id)
```

::: callout-note
#### Interpretation

-   The keeling plot suggests that CO2 concentration has a significant effect on both d13C-value and 14C-concent, which supports the hypothesis of a biological control with rapid turnover.

-   This relationship doesn't change signficantly with treatment. Perhaps the sample size is not enough to identify a meaningful effect?

-   The d13C source of CO2 is (-25‚Ä∞) (no signficant effect of slope or intercept across sites or treatment)

-   The 14C source of CO2 is between 99, 100m and 94. Which are large differences in 14C terms, but don't appear as significant effects in the model.
:::
